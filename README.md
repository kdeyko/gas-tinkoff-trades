# GAS Tinkoff Trades
![GAS Tinkoff Trades main image](https://github.com/ErhoSen/gas-tinkoff-trades/raw/master/images/main-image.jpg "GAS Tinkoff Trades main image")

–î–∞–Ω–Ω—ã–π [Google Apps Script](https://developers.google.com/apps-script) –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Å–¥–µ–ª–æ–∫ –∏–∑ –¢–∏–Ω—å–∫–æ—Ñ—Ñ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –ø—Ä—è–º–æ –≤ Google —Ç–∞–±–ª–∏—Ü—ã, –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞. 

–Ø ~~—Å–¥–µ–ª–∞–ª~~ _—Ñ–æ—Ä–∫–Ω—É–ª –∏ –¥–æ–ø–∏–ª–∏–ª_ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä—É—á–Ω–æ–≥–æ –≤–±–∏–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ç–∏–Ω—å–∫–æ—Ñ—Ñ, –∏ –Ω–∞–¥–µ—é—Å—å –æ–Ω –æ–∫–∞–∂–µ—Ç—Å—è –ø–æ–ª–µ–∑–µ–Ω –∫–æ–º—É-–Ω–∏–±—É–¥—å –µ—â—ë :)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

* –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç Google Spreadsheets http://drive.google.com
* –í –º–µ–Ω—é "Tools" –≤—ã–±—Ä–∞—Ç—å "Script Editor"
* –î–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—É –∏–º—è, –Ω–∞–ø—Ä–∏–º–µ—Ä `TinkoffTrades`
* –î–ª—è —Ä–∞–±–æ—Ç—ã —Å **API v1** (aka [invest-openapi](https://github.com/Tinkoff/invest-openapi))
    * –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏–∑ `Code-api-v1.gs`
    * –ü–æ–ª—É—á–∏—Ç—å [API-—Ç–æ–∫–µ–Ω —Ç–∏–Ω—å–∫–æ—Ñ—Ñ](https://tinkoff.github.io/invest-openapi/auth/)
* –î–ª—è —Ä–∞–±–æ—Ç—ã —Å **API v2** (aka [investAPI](https://github.com/Tinkoff/investAPI))
    * –î–æ–±–∞–≤–∏—Ç—å –∫–æ–¥ [–æ—Ç—Å—é–¥–∞](https://raw.githubusercontent.com/kdeyko/Tinkoff-REST-API-via-Google-Apps-Script/main/TinkoffApp.gs). –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª, –Ω–æ –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —ç—Ç–æ—Ç —Ñ–∞–π–ª –±—É–¥–µ—Ç –ø–µ—Ä–≤—ã–º –≤ —Å–ø–∏—Å–∫–µ.
    * –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏–∑ `Code-api-v2.gs`
    * –ü–æ–ª—É—á–∏—Ç—å [API-—Ç–æ–∫–µ–Ω —Ç–∏–Ω—å–∫–æ—Ñ—Ñ](https://tinkoff.github.io/investAPI/token/). –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ read-only —Ç–æ–∫–µ–Ω, –µ—Å–ª–∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é.
* –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ `API_TOKEN` –≤ —Ä–∞–∑–¥–µ–ª–µ `File -> Project properties -> Script properties` —Ä–∞–≤–Ω—ã–º —Ç–æ–∫–µ–Ω—É, –ø–æ–ª—É—á–µ–Ω–Ω–æ–º—É –≤—ã—à–µ. 
* –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–ø—Ç üíæ

–ù–∞ —ç—Ç–æ–º –≤—Å—ë. –¢–µ–ø–µ—Ä—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —ç—Ç–∏–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–º –Ω–∞ –≤—Å–µ—Ö –ª–∏—Å—Ç–∞—Ö –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –Ω–∏–∂–µ (–≤ API v2 –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–µ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏).

## –§—É–Ω–∫—Ü–∏–∏

* `=getPriceByTicker(ticker, dummy)` - –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–µ–Ω—É (`lastPrice`) —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –ø–æ —Ç–∏–∫–µ—Ä—É. –¢—Ä–µ–±—É–µ—Ç –Ω–∞ –≤—Ö–æ–¥ [—Ç–∏–∫–µ—Ä](https://ru.wikipedia.org/wiki/%D0%A2%D0%B8%D0%BA%D0%B5%D1%80) –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `dummy`. –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ `dummy` —è—á–µ–π–∫—É `Z1`. 

* `=getNameByTicker(ticker, dummy)` - –ü–æ–ª—É—á–∏—Ç—å –∏–º—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –ø–æ —Ç–∏–∫–µ—Ä—É. –¢—Ä–µ–±—É–µ—Ç –Ω–∞ –≤—Ö–æ–¥ [—Ç–∏–∫–µ—Ä](https://ru.wikipedia.org/wiki/%D0%A2%D0%B8%D0%BA%D0%B5%D1%80) –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `dummy`. –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ `dummy` —è—á–µ–π–∫—É `Z1`. 

* `=getCurrencyByTicker(ticker, dummy)` - –ü–æ–ª—É—á–∏—Ç—å –≤–∞–ª—é—Ç—É (`currency`) —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –ø–æ —Ç–∏–∫–µ—Ä—É. –¢—Ä–µ–±—É–µ—Ç –Ω–∞ –≤—Ö–æ–¥ [—Ç–∏–∫–µ—Ä](https://ru.wikipedia.org/wiki/%D0%A2%D0%B8%D0%BA%D0%B5%D1%80) –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `dummy`. –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ `dummy` —è—á–µ–π–∫—É `Z1`. 

* `=getTrades(ticker, from, to)` - —Ç—Ä–µ–±—É–µ—Ç –Ω–∞ –≤—Ö–æ–¥ [—Ç–∏–∫–µ—Ä](https://ru.wikipedia.org/wiki/%D0%A2%D0%B8%D0%BA%D0%B5%D1%80) –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –≤—Ä–µ–º–µ–Ω–∏. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `from` –∏ `to` —è–≤–ª—è—é—Ç—Å—è —Å—Ç—Ä–æ–∫–∞–º–∏ –∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ [ISO 8601 —Ñ–æ—Ä–º–∞—Ç–µ](https://ru.wikipedia.org/wiki/ISO_8601)
---
**NOTA BENE**: –°–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Å –ø–æ—Ä—Ç—Ñ–µ–ª–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –î–∞–Ω–Ω—ã–µ –æ –ø–æ—Ä—Ç—Ñ–µ–ª–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º –∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫—ç—à–µ (—Å–º. –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `EXPIRATION_IN_SECONDS`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10 —Å–µ–∫).

* `=getAccounts()` - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—á–µ—Ç–æ–≤ (`brokerAccountType`,`brokerAccountId`) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –±—Ä–æ–∫–µ—Ä—Å–∫–∏–µ –∏ –ò–ò–°. 

* `=getAccountBalanceByTicker(accountId, ticker, dummy)` - –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ –ø–æ —Ç–∏–∫–µ—Ä—É –∏ accountId. –¢—Ä–µ–±—É–µ—Ç –Ω–∞ –≤—Ö–æ–¥ `accountId` (–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ `getAccounts()`), [—Ç–∏–∫–µ—Ä](https://ru.wikipedia.org/wiki/%D0%A2%D0%B8%D0%BA%D0%B5%D1%80) –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `dummy`. –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ `dummy` —è—á–µ–π–∫—É `Z1`. 

* `=getAccountBalanceByCurrency(accountId, currency, dummy)` - –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤–∞–ª—é—Ç—ã –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ –ø–æ –∏–º–µ–Ω–∏ –≤–∞–ª—é—Ç—ã –∏ accountId. –¢—Ä–µ–±—É–µ—Ç –Ω–∞ –≤—Ö–æ–¥ `accountId` (–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ `getAccounts()`), `currency` (RUB, USD, EUR, etc.) –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `dummy`. –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ `dummy` —è—á–µ–π–∫—É `Z1`. 

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* –°–∫—Ä–∏–ø—Ç —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç —è—á–µ–π–∫—É `Z1` (—Å–∞–º–∞—è –ø—Ä–∞–≤–∞—è —è—á–µ–π–∫–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏), –≤ –∫–æ—Ç–æ—Ä—É—é –≤—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –Ω–∞ –∫–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª–∏—Å—Ç–∞. –î–∞–Ω–Ω–∞—è —è—á–µ–π–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `getPriceByTicker`, - –æ–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç [–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å](https://stackoverflow.com/a/27656313) —Ç–µ–∫—É—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–∏–∫–µ—Ä–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ª–∏—Å—Ç–∞.

* –°—Ä–µ–¥–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∫—Ä–∏–ø—Ç–∞ –µ—Å—Ç—å `TRADING_START_AT` - –¥–µ—Ñ–æ–ª—Ç–Ω–∞—è –¥–∞—Ç–∞, –Ω–∞—á–∏–Ω–∞—è —Å –∫–æ—Ç–æ—Ä–æ–π —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏–∏ `getTrades`. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç—Ç–æ `Apr 01, 2020 10:00:00`, –Ω–æ –¥–∞–Ω–Ω—É—é –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –º–æ–∂–Ω–æ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –ø–æ–º–µ–Ω—è—Ç—å –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ.

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è 

```
=getPriceByTicker("V", Z1)  # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É –∞–∫—Ü–∏–∏ Visa
=getPriceByTicker("FXMM", Z1)  # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É —Ñ–æ–Ω–¥–∞ –∫–∞–∑–Ω–∞—á–µ–π—Å–∫–∏—Ö –æ–±–ª–∏–≥–∞—Ü–∏–π –°–®–ê

=getTrades("V") 
# –í–µ—Ä–Ω—ë—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∞–∫—Ü–∏–µ–π Visa, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏ –Ω–∞—á–∏–Ω–∞—è —Å TRADING_START_AT –∏ –ø–æ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç.
=getTrades("V", "2020-05-01T00:00:00.000Z") 
# –í–µ—Ä–Ω—ë—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∞–∫—Ü–∏–µ–π Visa, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏ –Ω–∞—á–∏–Ω–∞—è —Å 1 –º–∞—è –∏ –ø–æ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Çs.
=getTrades("V", "2020-05-01T00:00:00.000Z", "2020-05-05T23:59:59.999Z") 
# –í–µ—Ä–Ω—ë—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∞–∫—Ü–∏–µ–π Visa, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏ –≤ –ø–µ—Ä–∏–æ–¥ —Å 1 –∏ –ø–æ 5 –º–∞—è.
```

## –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

#### `=getTrades()`
![getTrades in action](https://github.com/ErhoSen/gas-tinkoff-trades/raw/master/images/get-trades-in-action.gif "getTrades in Action")

#### `=getPriceByTicker()`
![Get price by ticker in action](https://github.com/ErhoSen/gas-tinkoff-trades/raw/master/images/get-price-by-ticker.gif)
